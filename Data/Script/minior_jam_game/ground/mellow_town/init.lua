--[[
    init.lua
    Created: 03/30/2025 16:04:06
    Description: Autogenerated script file for the map mellow_town.
]]--
-- Commonly included lua functions and data
require 'origin.common'

-- Package name
local mellow_town = {}

-------------------------------
-- Map Callbacks
-------------------------------
---mellow_town.Init(map)
--Engine callback function
function mellow_town.Init(map)


end

---mellow_town.Enter(map)
--Engine callback function
function mellow_town.Enter(map)

  GAME:FadeIn(20)

end

---mellow_town.Exit(map)
--Engine callback function
function mellow_town.Exit(map)


end

---mellow_town.Update(map)
--Engine callback function
function mellow_town.Update(map)


end

---mellow_town.GameSave(map)
--Engine callback function
function mellow_town.GameSave(map)


end

---mellow_town.GameLoad(map)
--Engine callback function
function mellow_town.GameLoad(map)

  GAME:FadeIn(20)

end

-------------------------------
-- Entities Callbacks
-------------------------------

function mellow_town.STORAGE_COUNTER_Action(obj, activator)
  UI:ResetSpeaker()

  local state = 0

  while state > -1 do

  local has_items = GAME:GetPlayerBagCount() + GAME:GetPlayerEquippedCount() > 0
  local has_storage = GAME:GetPlayerStorageCount() > 0


  local storage_choices = { { STRINGS:FormatKey('MENU_STORAGE_STORE'), has_items},
  { STRINGS:FormatKey('MENU_STORAGE_TAKE_ITEM'), has_storage},
  { STRINGS:FormatKey('MENU_STORAGE_STORE_ALL'), has_items},
  { STRINGS:FormatKey("MENU_CANCEL"), true}}
  UI:BeginChoiceMenu(STRINGS:FormatKey('DLG_WHAT_DO'), storage_choices, 1, 5)
  UI:WaitForChoice()
  local result = UI:ChoiceResult()

  if result == 1 then
    UI:StorageMenu()
    UI:WaitForChoice()
  elseif result == 2 then
    UI:WithdrawMenu()
    UI:WaitForChoice()
    elseif result == 3 then
      UI:ChoiceMenuYesNo(STRINGS:FormatKey('DLG_STORE_ALL_CONFIRM'), false);
      UI:WaitForChoice()
      if UI:ChoiceResult() then
        GAME:DepositAll()
      end
  elseif result == 4 then
    state = -1
  end

  end
end

-- Gholdengo Bank
function mellow_town.BANK_COUNTER_Action(obj, activator)
  UI:BankMenu()
  UI:WaitForChoice()
end

return mellow_town
